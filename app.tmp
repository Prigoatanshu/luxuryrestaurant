from __future__ import annotations

from http.server import SimpleHTTPRequestHandler, ThreadingHTTPServer
from pathlib import Path
import argparse
import os
import shutil
from datetime import datetime

ROOT = Path(__file__).resolve().parent
TEMPLATES_DIR = ROOT / "templates"
STYLES_DIR = ROOT / "styles"
SCRIPTS_DIR = ROOT / "scripts"
SITE_DIR = ROOT / "site"

RESTAURANT = {
    "name": "Maison Ember",
    "tagline": "Modern fine dining with a warm, refined soul.",
    "address": "1458 Hartwell Avenue, San Francisco, CA",
    "phone": "(415) 555-0172",
    "email": "hello@maisonember.com",
    "hours": "Tue - Sun, 5:00 PM - 10:30 PM",
}

DISHES = [
    {
        "name": "Citrus Cured Salmon",
        "course": "Starter",
        "description": "Yuzu, shaved fennel, pickled shallot, dill oil.",
        "price": "$18",
    },
    {
        "name": "Truffle Potato Pave",
        "course": "Starter",
        "description": "Brown butter, pecorino, smoked salt.",
        "price": "$16",
    },
    {
        "name": "Charred Octopus",
        "course": "Starter",
        "description": "Chickpea puree, paprika glaze, crisp herbs.",
        "price": "$22",
    },
    {
        "name": "Burrata and Heirloom Tomato",
        "course": "Starter",
        "description": "Basil oil, aged balsamic, toasted sourdough.",
        "price": "$17",
    },
    {
        "name": "Saffron Arancini",
        "course": "Starter",
        "description": "Mozzarella core, tomato confit, lemon zest.",
        "price": "$15",
    },
    {
        "name": "Spiced Cauliflower",
        "course": "Starter",
        "description": "Tamarind glaze, mint yogurt, toasted seeds.",
        "price": "$14",
    },
    {
        "name": "Beetroot Tartare",
        "course": "Starter",
        "description": "Cured egg yolk, capers, grain mustard.",
        "price": "$16",
    },
    {
        "name": "Crab Toast",
        "course": "Starter",
        "description": "Lemon aioli, chive, toasted brioche.",
        "price": "$20",
    },
    {
        "name": "Dry-Aged Ribeye",
        "course": "Main",
        "description": "Bone marrow butter, rosemary jus, charred onions.",
        "price": "$52",
    },
    {
        "name": "Herb Roasted Duck Breast",
        "course": "Main",
        "description": "Black cherry gastrique, wild rice, juniper.",
        "price": "$44",
    },
    {
        "name": "Braised Short Rib",
        "course": "Main",
        "description": "Celery root puree, roasted shallots, red wine.",
        "price": "$46",
    },
    {
        "name": "Smoked Saffron Lamb",
        "course": "Main",
        "description": "Mint oil, cumin jus, heirloom carrots.",
        "price": "$48",
    },
    {
        "name": "Miso Glazed Chicken",
        "course": "Main",
        "description": "Ginger sesame glaze, jasmine rice, scallions.",
        "price": "$36",
    },
    {
        "name": "Porcini Crusted Pork Loin",
        "course": "Main",
        "description": "Apple compote, sage brown butter, fennel.",
        "price": "$40",
    },
    {
        "name": "Duck Confit",
        "course": "Main",
        "description": "Garlic potatoes, citrus salad, duck jus.",
        "price": "$42",
    },
    {
        "name": "Wagyu Striploin",
        "course": "Main",
        "description": "Truffle jus, sauteed mushrooms, chives.",
        "price": "$65",
    },
    {
        "name": "Peppercorn Tenderloin",
        "course": "Main",
        "description": "Creamed spinach, cognac sauce, crispy shallots.",
        "price": "$54",
    },
    {
        "name": "Pan Seared Sea Bass",
        "course": "Seafood",
        "description": "Charred lemon, saffron broth, baby fennel.",
        "price": "$42",
    },
    {
        "name": "Lobster Risotto",
        "course": "Seafood",
        "description": "Corn puree, basil oil, toasted garlic.",
        "price": "$48",
    },
    {
        "name": "Blackened Cod",
        "course": "Seafood",
        "description": "Coconut curry, charred lime, coriander.",
        "price": "$38",
    },
    {
        "name": "Chili Prawns",
        "course": "Seafood",
        "description": "Gochujang butter, garlic chips, lime.",
        "price": "$36",
    },
    {
        "name": "Scallop and Corn Puree",
        "course": "Seafood",
        "description": "Crispy prosciutto, fennel pollen, pea shoots.",
        "price": "$40",
    },
    {
        "name": "Seasonal Paneer",
        "course": "Vegetarian",
        "description": "Smoked tomato, fenugreek, pickled onions.",
        "price": "$32",
    },
    {
        "name": "Summer Squash Agnolotti",
        "course": "Vegetarian",
        "description": "Lemon beurre blanc, herbs, toasted hazelnut.",
        "price": "$30",
    },
    {
        "name": "Charcoal Beetroot",
        "course": "Vegetarian",
        "description": "Goat cheese, pistachio crumble, sherry glaze.",
        "price": "$28",
    },
    {
        "name": "Truffle Gnocchi",
        "course": "Vegetarian",
        "description": "Porcini cream, shaved parmesan, chives.",
        "price": "$31",
    },
    {
        "name": "Wild Mushroom Tagliatelle",
        "course": "Vegetarian",
        "description": "Garlic butter, parsley, aged pecorino.",
        "price": "$29",
    },
    {
        "name": "Cardamom Cloud",
        "course": "Dessert",
        "description": "Rose milk granita, pistachio praline.",
        "price": "$18",
    },
    {
        "name": "Dark Chocolate Torte",
        "course": "Dessert",
        "description": "Sea salt caramel, espresso cream.",
        "price": "$17",
    },
    {
        "name": "Rose Pistachio Creme",
        "course": "Dessert",
        "description": "Honeyed pastry, berry compote, almond dust.",
        "price": "$16",
    },
]

TEMPLATE_HTML = """<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{restaurant_name} | Fine Dining Restaurant</title>
  <meta name="description" content="{restaurant_name} offers a premium dining experience with seasonal tasting menus, curated pairings, and an intimate atmosphere.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="ambient-orb orb-one" data-parallax></div>
  <div class="ambient-orb orb-two" data-parallax></div>
  <div class="noise-layer"></div>

  <header class="topbar">
    <div class="brand">
      <span class="brand-mark">{restaurant_name}</span>
      <span class="brand-sub">Fine Dining</span>
    </div>
    <nav class="nav-links">
      <a href="#experience">Experience</a>
      <a href="#story">Story</a>
      <a href="#menu">Menu</a>
      <a href="#gallery">Gallery</a>
      <a href="#reserve">Reserve</a>
    </nav>
    <a class="btn btn-solid" href="#reserve">Reserve</a>
  </header>

  <main>
    <section class="hero" id="experience">
      <div class="hero-copy reveal">
        <p class="eyebrow">The art of modern dining</p>
        <h1>Crafted evenings, plated with purpose.</h1>
        <p class="lead">{restaurant_tagline} Enjoy a seasonal tasting menu, signature cocktails, and a space designed for memorable nights.</p>
        <div class="cta-row">
          <a class="btn btn-solid" href="#reserve">Reserve a Table</a>
          <a class="btn btn-outline" href="#menu">Explore the Menu</a>
        </div>
        <div class="stat-row">
          <div class="stat">
            <span class="stat-value">28</span>
            <span class="stat-label">Years of craft</span>
          </div>
          <div class="stat">
            <span class="stat-value">30</span>
            <span class="stat-label">Signature dishes</span>
          </div>
          <div class="stat">
            <span class="stat-value">4.9</span>
            <span class="stat-label">Guest rating</span>
          </div>
        </div>
      </div>
      <div class="hero-media reveal">
        <div class="media-card media-tall">
          <span class="card-tag">Chef's table</span>
          <span class="card-title">Seven-course tasting</span>
        </div>
        <div class="media-card media-wide">
          <span class="card-tag">Signature</span>
          <span class="card-title">Smoked saffron lamb</span>
        </div>
        <div class="media-card media-square">
          <span class="card-tag">Cocktail lab</span>
          <span class="card-title">Botanical pairings</span>
        </div>
      </div>
    </section>

    <section class="marquee reveal">
      <div class="marquee-track">
        <span>Now taking reservations for February experiences</span>
        <span>Seasonal prix fixe menu available nightly</span>
        <span>Private dining suites for intimate celebrations</span>
      </div>
    </section>

    <section class="experience-strip reveal">
      <div class="strip-item">
        <span class="strip-title">Premium service</span>
        <p>Attentive, personalized hospitality with a calm, modern atmosphere.</p>
      </div>
      <div class="strip-item">
        <span class="strip-title">Layered flavors</span>
        <p>Spice-forward courses balanced with delicate techniques and texture.</p>
      </div>
      <div class="strip-item">
        <span class="strip-title">Curated pairings</span>
        <p>Sommelier-led pairings and spirit-forward cocktails.</p>
      </div>
    </section>

    <section class="split story" id="story">
      <div class="image-tile tile-portrait reveal">
        <div class="tile-label">Our story</div>
      </div>
      <div class="copy reveal">
        <p class="eyebrow">About {restaurant_name}</p>
        <h2>Modern cuisine with a timeless soul.</h2>
        <p>Rooted in heritage recipes and elevated by contemporary technique, our kitchen celebrates the craft of hospitality. Each menu highlights seasonal ingredients, balanced spice work, and precision plating.</p>
        <ul class="bullet-list">
          <li>Seasonal ingredients sourced weekly</li>
          <li>Vegetarian and dietary-friendly offerings</li>
          <li>Private dining and chef experiences</li>
        </ul>
        <a class="btn btn-outline" href="#reserve">Reserve your evening</a>
      </div>
    </section>

    <section class="signature" id="menu">
      <div class="section-head reveal">
        <p class="eyebrow">Signature menu</p>
        <h2>Thirty dishes, crafted nightly.</h2>
        <p class="section-lead">The menu below highlights our current favorites, with seasonal updates throughout the year.</p>
      </div>
      <div class="menu-grid">
        {menu_items}
      </div>
    </section>

    <section class="ambience">
      <div class="ambience-card reveal">
        <p class="eyebrow">The setting</p>
        <h2>Intimate lighting, warm textures, and a quiet sense of luxury.</h2>
        <p>Designed for date nights, celebrations, and private events, our space blends natural stone, rich textiles, and contemporary lines.</p>
        <div class="pill-row">
          <span class="pill">Private suites</span>
          <span class="pill">Chef counter</span>
          <span class="pill">Curated bar</span>
        </div>
      </div>
    </section>

    <section class="gallery" id="gallery">
      <div class="section-head reveal">
        <p class="eyebrow">Gallery</p>
        <h2>A glimpse inside {restaurant_name}.</h2>
      </div>
      <div class="gallery-grid">
        <div class="image-tile tile-wide reveal"><span class="tile-label">The lounge</span></div>
        <div class="image-tile tile-square reveal"><span class="tile-label">Chef's counter</span></div>
        <div class="image-tile tile-tall reveal"><span class="tile-label">Dining room</span></div>
        <div class="image-tile tile-square reveal"><span class="tile-label">Private suite</span></div>
        <div class="image-tile tile-wide reveal"><span class="tile-label">Signature bar</span></div>
      </div>
    </section>

    <section class="awards">
      <div class="section-head reveal">
        <p class="eyebrow">Recognized by</p>
        <h2>Celebrated across the city.</h2>
      </div>
      <div class="press-row">
        <div class="press-card reveal">City Journal</div>
        <div class="press-card reveal">Dining Review</div>
        <div class="press-card reveal">Metropolitan</div>
        <div class="press-card reveal">Cuisine Guide</div>
      </div>
    </section>

    <section class="testimonials">
      <div class="section-head reveal">
        <p class="eyebrow">Testimonials</p>
        <h2>Guests remember the details.</h2>
      </div>
      <div class="card-grid">
        <article class="testimonial-card reveal">
          <p>"Every course arrived like a story. The pacing, the aromas, the details were flawless."</p>
          <span class="guest">Amelia S.</span>
        </article>
        <article class="testimonial-card reveal">
          <p>"A luxurious evening with flavors that felt bold yet balanced. We loved the tasting menu."</p>
          <span class="guest">Jordan K.</span>
        </article>
        <article class="testimonial-card reveal">
          <p>"Impeccable service and cocktails that were clearly crafted with intention."</p>
          <span class="guest">Priya N.</span>
        </article>
      </div>
    </section>

    <section class="reserve" id="reserve">
      <div class="section-head reveal">
        <p class="eyebrow">Reserve</p>
        <h2>Reserve now for a refined evening.</h2>
      </div>
      <div class="reserve-grid">
        <div class="reserve-card reveal">
          <h3>Hours of operation</h3>
          <p>{hours}</p>
          <div class="contact-block">
            <span>{address}</span>
            <span>{phone}</span>
            <span>{email}</span>
          </div>
          <div class="reserve-extra">
            <div>
              <span class="label">Private dining</span>
              <p>Intimate suites for parties of 6-14.</p>
            </div>
            <div>
              <span class="label">Chef's table</span>
              <p>Limited seating, nightly reservations.</p>
            </div>
          </div>
        </div>
        <form class="reserve-form reveal">
          <div class="field">
            <label for="name">Your name</label>
            <input id="name" type="text" placeholder="Name">
          </div>
          <div class="field">
            <label for="email">Email address</label>
            <input id="email" type="email" placeholder="Email">
          </div>
          <div class="field">
            <label for="phone">Phone number</label>
            <input id="phone" type="tel" placeholder="Phone">
          </div>
          <div class="field">
            <label for="date">Date</label>
            <input id="date" type="date">
          </div>
          <div class="field">
            <label for="time">Time</label>
            <select id="time">
              <option>06:30 PM</option>
              <option>07:00 PM</option>
              <option>07:30 PM</option>
              <option>08:00 PM</option>
              <option>08:30 PM</option>
              <option>09:00 PM</option>
            </select>
          </div>
          <div class="field">
            <label for="party">Guests</label>
            <select id="party">
              <option>2 Guests</option>
              <option>4 Guests</option>
              <option>6 Guests</option>
              <option>8 Guests</option>
            </select>
          </div>
          <div class="field full">
            <label for="message">Message</label>
            <textarea id="message" rows="4" placeholder="Tell us about your celebration"></textarea>
          </div>
          <button class="btn btn-solid" type="submit">Enquire Now</button>
        </form>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-grid">
      <div>
        <div class="brand">
          <span class="brand-mark">{restaurant_name}</span>
          <span class="brand-sub">Fine Dining</span>
        </div>
        <p>Fine dining inspired by heritage, delivered with modern craft.</p>
      </div>
      <div>
        <h4>Visit</h4>
        <p>{address}</p>
        <p>{hours}</p>
      </div>
      <div>
        <h4>Contact</h4>
        <p>{phone}</p>
        <p>{email}</p>
      </div>
    </div>
    <div class="footer-bottom">{restaurant_name} Copyright {year}. All Rights Reserved.</div>
  </footer>

  <script src="scripts/main.js"></script>
</body>
</html>
"""

STYLE_CSS = """:root {
  --bg: #0b0a08;
  --bg-alt: #14110f;
  --ink: #f6efe6;
  --muted: #c7b9ab;
  --accent: #d0a66f;
  --accent-2: #f0d6a7;
  --line: rgba(255, 255, 255, 0.12);
  --glass: rgba(20, 16, 12, 0.82);
  --shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: "Manrope", sans-serif;
  background: radial-gradient(circle at 20% 20%, rgba(240, 214, 167, 0.12), transparent 55%),
    radial-gradient(circle at 80% 0%, rgba(208, 166, 111, 0.14), transparent 60%),
    var(--bg);
  color: var(--ink);
  min-height: 100vh;
  line-height: 1.6;
  overflow-x: hidden;
}

.noise-layer {
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220' viewBox='0 0 220 220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
  opacity: 0.4;
  pointer-events: none;
  z-index: 0;
}

.ambient-orb {
  position: fixed;
  border-radius: 999px;
  background: radial-gradient(circle, rgba(240, 214, 167, 0.25), transparent 70%);
  pointer-events: none;
  z-index: 0;
}

.orb-one {
  width: 520px;
  height: 520px;
  top: -120px;
  left: -140px;
}

.orb-two {
  width: 420px;
  height: 420px;
  top: 180px;
  right: -180px;
  background: radial-gradient(circle, rgba(208, 166, 111, 0.28), transparent 70%);
}

a {
  color: inherit;
  text-decoration: none;
}

main {
  position: relative;
  z-index: 1;
}

.topbar {
  position: sticky;
  top: 0;
  z-index: 20;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 6vw;
  backdrop-filter: blur(16px);
  background: rgba(9, 7, 6, 0.75);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.brand {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.brand-mark {
  font-family: "Cormorant Garamond", serif;
  font-size: 26px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
}

.brand-sub {
  font-size: 11px;
  letter-spacing: 0.32em;
  text-transform: uppercase;
  color: var(--muted);
}

.nav-links {
  display: flex;
  gap: 28px;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.22em;
}

.nav-links a {
  color: var(--muted);
  transition: color 0.3s ease;
}

.nav-links a:hover {
  color: var(--ink);
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 26px;
  border-radius: 999px;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.28em;
  transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
}

.btn-solid {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: #1b120d;
  box-shadow: 0 10px 30px rgba(199, 154, 99, 0.35);
}

.btn-solid:hover {
  transform: translateY(-2px);
}

.btn-outline {
  border: 1px solid rgba(255, 255, 255, 0.25);
  color: var(--ink);
}

.btn-outline:hover {
  border-color: var(--accent);
}

.hero {
  display: grid;
  grid-template-columns: 1.05fr 0.95fr;
  gap: 60px;
  padding: 120px 6vw 90px;
  align-items: center;
}

.eyebrow {
  text-transform: uppercase;
  letter-spacing: 0.4em;
  font-size: 12px;
  color: var(--accent-2);
  margin-bottom: 16px;
}

.hero-copy h1 {
  font-family: "Cormorant Garamond", serif;
  font-size: clamp(2.8rem, 4.4vw, 4.8rem);
  line-height: 1.05;
  margin-bottom: 20px;
}

.lead {
  color: var(--muted);
  max-width: 520px;
  font-size: 1.05rem;
}

.cta-row {
  display: flex;
  gap: 18px;
  flex-wrap: wrap;
  margin: 28px 0 32px;
}

.stat-row {
  display: flex;
  gap: 28px;
  flex-wrap: wrap;
}

.stat {
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.08);
  padding: 14px 18px;
  border-radius: 16px;
  min-width: 140px;
}

.stat-value {
  font-family: "Cormorant Garamond", serif;
  font-size: 1.6rem;
  display: block;
}

.stat-label {
  font-size: 11px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.22em;
}

.hero-media {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-auto-rows: 190px;
  gap: 18px;
}

.media-card {
  position: relative;
  border-radius: 24px;
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.1), transparent),
    radial-gradient(circle at top left, rgba(208, 166, 111, 0.5), transparent 60%),
    linear-gradient(170deg, #2a1b15, #0f0b0a);
  padding: 20px;
  box-shadow: var(--shadow);
  overflow: hidden;
}

.media-card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.7));
  opacity: 0.35;
}

.media-tall {
  grid-row: span 2;
}

.media-wide {
  grid-column: span 2;
}

.media-square {
  grid-column: span 1;
}

.card-tag {
  position: relative;
  z-index: 1;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: var(--accent-2);
}

.card-title {
  position: relative;
  z-index: 1;
  display: block;
  margin-top: 10px;
  font-size: 18px;
  font-weight: 600;
}

.marquee {
  overflow: hidden;
  border-top: 1px solid rgba(255, 255, 255, 0.08);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  margin: 0 6vw 70px;
}

.marquee-track {
  display: flex;
  gap: 48px;
  padding: 16px 0;
  font-size: 12px;
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: var(--muted);
  animation: marquee 18s linear infinite;
}

.marquee-track span {
  white-space: nowrap;
}

@keyframes marquee {
  0% { transform: translateX(0); }
  100% { transform: translateX(-40%); }
}

.experience-strip {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 22px;
  padding: 0 6vw 80px;
}

.strip-item {
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.08);
  padding: 26px;
  border-radius: 20px;
}

.strip-title {
  display: block;
  font-family: "Cormorant Garamond", serif;
  font-size: 1.4rem;
  margin-bottom: 10px;
}

.split {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 60px;
  align-items: center;
  padding: 80px 6vw;
}

.image-tile {
  position: relative;
  border-radius: 28px;
  min-height: 360px;
  background: linear-gradient(140deg, rgba(255, 255, 255, 0.12), transparent),
    radial-gradient(circle at 30% 20%, rgba(240, 214, 167, 0.45), transparent 55%),
    linear-gradient(160deg, #2b1d16, #0e0a09);
  overflow: hidden;
  box-shadow: var(--shadow);
}

.image-tile::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.6));
}

.tile-label {
  position: absolute;
  bottom: 18px;
  left: 18px;
  font-size: 12px;
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: var(--accent-2);
  z-index: 1;
}

.copy h2 {
  font-family: "Cormorant Garamond", serif;
  font-size: clamp(2.2rem, 3vw, 3.2rem);
  margin-bottom: 16px;
}

.copy p {
  color: var(--muted);
  margin-bottom: 18px;
}

.bullet-list {
  list-style: none;
  display: grid;
  gap: 10px;
  margin-bottom: 24px;
}

.bullet-list li {
  position: relative;
  padding-left: 18px;
  color: var(--muted);
}

.bullet-list li::before {
  content: "";
  position: absolute;
  left: 0;
  top: 9px;
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--accent);
}

.section-head {
  padding: 0 6vw 40px;
}

.section-head h2 {
  font-family: "Cormorant Garamond", serif;
  font-size: clamp(2.1rem, 3.4vw, 3.4rem);
}

.section-lead {
  color: var(--muted);
  max-width: 580px;
  margin-top: 10px;
}

.signature {
  padding-bottom: 40px;
}

.menu-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 18px;
  padding: 0 6vw 80px;
}

.menu-item {
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.08);
  padding: 24px;
  border-radius: 22px;
  box-shadow: var(--shadow);
  display: grid;
  gap: 10px;
}

.menu-item h3 {
  font-family: "Cormorant Garamond", serif;
  font-size: 1.4rem;
}

.menu-meta {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  letter-spacing: 0.28em;
  text-transform: uppercase;
  color: var(--accent-2);
}

.menu-price {
  color: var(--muted);
}

.ambience {
  padding: 80px 6vw;
}

.ambience-card {
  background: linear-gradient(135deg, rgba(208, 166, 111, 0.12), rgba(22, 17, 14, 0.92));
  border-radius: 28px;
  padding: 50px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: var(--shadow);
}

.pill-row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  margin-top: 20px;
}

.pill {
  border: 1px solid rgba(255, 255, 255, 0.2);
  padding: 8px 16px;
  border-radius: 999px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--muted);
}

.gallery {
  padding-bottom: 80px;
}

.gallery-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-auto-rows: 200px;
  gap: 18px;
  padding: 0 6vw;
}

.tile-wide {
  grid-column: span 2;
}

.tile-tall {
  grid-row: span 2;
}

.tile-square {
  grid-column: span 1;
}

.awards {
  padding: 30px 0 40px;
}

.press-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px;
  padding: 0 6vw 80px;
}

.press-card {
  padding: 20px;
  border-radius: 18px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  text-align: center;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: var(--muted);
}

.card-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
  padding: 0 6vw 80px;
}

.testimonial-card {
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.08);
  padding: 28px;
  border-radius: 22px;
  box-shadow: var(--shadow);
}

.testimonial-card p {
  font-size: 1rem;
  margin-bottom: 16px;
}

.guest {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--accent-2);
}

.reserve {
  padding-bottom: 120px;
}

.reserve-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 28px;
  padding: 0 6vw;
}

.reserve-card {
  background: var(--glass);
  border-radius: 22px;
  padding: 30px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  display: grid;
  gap: 14px;
}

.contact-block {
  display: grid;
  gap: 6px;
  color: var(--muted);
}

.reserve-extra {
  margin-top: 14px;
  display: grid;
  gap: 12px;
}

.reserve-extra .label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: var(--accent-2);
}

.reserve-form {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
}

.field {
  display: grid;
  gap: 6px;
}

.field label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.24em;
  color: var(--muted);
}

.field input,
.field select,
.field textarea {
  background: rgba(15, 10, 8, 0.85);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 12px;
  padding: 12px 14px;
  color: var(--ink);
  font-family: "Manrope", sans-serif;
}

.field.full {
  grid-column: span 2;
}

.footer {
  padding: 60px 6vw 30px;
  border-top: 1px solid rgba(255, 255, 255, 0.08);
}

.footer-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 28px;
  margin-bottom: 30px;
}

.footer h4 {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  margin-bottom: 10px;
  color: var(--accent-2);
}

.footer p {
  color: var(--muted);
}

.footer-bottom {
  text-align: center;
  font-size: 12px;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--muted);
}

.reveal {
  opacity: 0;
  transform: translateY(18px);
  transition: opacity 0.8s ease, transform 0.8s ease;
}

.reveal.is-visible {
  opacity: 1;
  transform: translateY(0);
}

@media (max-width: 1100px) {
  .hero,
  .split,
  .reserve-grid {
    grid-template-columns: 1fr;
  }

  .experience-strip,
  .card-grid,
  .gallery-grid,
  .press-row,
  .footer-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .menu-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (max-width: 820px) {
  .nav-links {
    display: none;
  }

  .experience-strip,
  .card-grid,
  .gallery-grid,
  .press-row,
  .footer-grid,
  .menu-grid {
    grid-template-columns: 1fr;
  }

  .topbar {
    padding: 18px 5vw;
  }

  .hero {
    padding-top: 80px;
  }

  .reserve-form {
    grid-template-columns: 1fr;
  }

  .field.full {
    grid-column: span 1;
  }
}

@media (prefers-reduced-motion: reduce) {
  .reveal {
    transition: none;
  }

  .marquee-track {
    animation: none;
  }
}
"""

SCRIPT_JS = """document.addEventListener("DOMContentLoaded", () => {
  const reveals = document.querySelectorAll(".reveal");
  const parallaxItems = document.querySelectorAll("[data-parallax]");

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.2 }
  );

  reveals.forEach((item, index) => {
    item.style.transitionDelay = `${Math.min(index * 70, 350)}ms`;
    observer.observe(item);
  });

  let ticking = false;
  const onScroll = () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        const offset = window.scrollY;
        parallaxItems.forEach((item, index) => {
          const depth = (index + 1) * 0.04;
          item.style.transform = `translateY(${offset * depth}px)`;
        });
        ticking = false;
      });
      ticking = true;
    }
  };

  window.addEventListener("scroll", onScroll, { passive: true });
});
"""

class SafeDict(dict):
    def __missing__(self, key: str) -> str:
        return "{" + key + "}"


def ensure_source_file(path: Path, content: str) -> None:
    path.parent.mkdir(parents=True, exist_ok=True)
    if not path.exists():
        path.write_text(content, encoding="utf-8")


def render_menu_items() -> str:
    items = []
    for dish in DISHES:
        items.append(
            "\n".join(
                [
                    "<article class=\"menu-item reveal\">",
                    "  <div class=\"menu-meta\">",
                    f"    <span>{dish['course']}</span>",
                    f"    <span class=\"menu-price\">{dish['price']}</span>",
                    "  </div>",
                    f"  <h3>{dish['name']}</h3>",
                    f"  <p>{dish['description']}</p>",
                    "</article>",
                ]
            )
        )
    return "\n".join(items)

def build() -> None:
    ensure_source_file(TEMPLATES_DIR / "index.html", TEMPLATE_HTML)
    ensure_source_file(STYLES_DIR / "main.css", STYLE_CSS)
    ensure_source_file(SCRIPTS_DIR / "main.js", SCRIPT_JS)

    template_text = (TEMPLATES_DIR / "index.html").read_text(encoding="utf-8")
    menu_items = render_menu_items()

    values = SafeDict(
        restaurant_name=RESTAURANT["name"],
        restaurant_tagline=RESTAURANT["tagline"],
        address=RESTAURANT["address"],
        phone=RESTAURANT["phone"],
        email=RESTAURANT["email"],
        hours=RESTAURANT["hours"],
        year=str(datetime.now().year),
        menu_items=menu_items,
    )

    rendered_html = template_text.format_map(values)

    SITE_DIR.mkdir(parents=True, exist_ok=True)
    (SITE_DIR / "index.html").write_text(rendered_html, encoding="utf-8")

    (SITE_DIR / "styles").mkdir(parents=True, exist_ok=True)
    (SITE_DIR / "scripts").mkdir(parents=True, exist_ok=True)
    shutil.copy2(STYLES_DIR / "main.css", SITE_DIR / "styles" / "main.css")
    shutil.copy2(SCRIPTS_DIR / "main.js", SITE_DIR / "scripts" / "main.js")


def serve(host: str, port: int) -> None:
    os.chdir(SITE_DIR)
    httpd = ThreadingHTTPServer((host, port), SimpleHTTPRequestHandler)
    print(f"Serving on http://{host}:{port}")
    httpd.serve_forever()


def main() -> None:
    parser = argparse.ArgumentParser(description="Generate and serve the Maison Ember site.")
    parser.add_argument("--build", action="store_true", help="Only build the site files.")
    parser.add_argument("--serve", action="store_true", help="Serve the site after building.")
    parser.add_argument("--host", default="127.0.0.1")
    parser.add_argument("--port", default=8000, type=int)
    args = parser.parse_args()

    build()
    if args.serve or not args.build:
        serve(args.host, args.port)


if __name__ == "__main__":
    main()
